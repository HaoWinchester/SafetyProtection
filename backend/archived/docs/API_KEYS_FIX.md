# APIå¯†é’¥ä¸¢å¤±é—®é¢˜ - å·²è§£å†³

## ğŸ“‹ é—®é¢˜è¯´æ˜

**é—®é¢˜**: ä¹‹å‰æ–°å¢çš„API Keyæ²¡æœ‰äº†

**åŸå› **:
1. `simple_server.py` ä½¿ç”¨**å†…å­˜æ•°æ®åº“**ï¼ˆPythonå­—å…¸ï¼‰å­˜å‚¨APIå¯†é’¥
2. å½“æœåŠ¡å™¨é‡å¯æ—¶ï¼Œå†…å­˜æ•°æ®ä¼šä¸¢å¤±
3. é‡ç½®æ•°æ®åº“schemaæ—¶ï¼Œåªæœ‰æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ä¿ç•™

## âœ… è§£å†³æ–¹æ¡ˆ

### å·²æ‰§è¡Œçš„æ“ä½œ

1. **åˆ›å»ºäº†æŒä¹…åŒ–å­˜å‚¨çš„APIå¯†é’¥**
   - ä½¿ç”¨PostgreSQLæ•°æ®åº“å­˜å‚¨
   - åˆ›å»ºäº†4ä¸ªæµ‹è¯•APIå¯†é’¥
   - å¯†é’¥æ°¸ä¹…ä¿å­˜ï¼ŒæœåŠ¡å™¨é‡å¯ä¸ä¼šä¸¢å¤±

2. **ç”Ÿæˆçš„APIå¯†é’¥åˆ—è¡¨**

#### 1. é»˜è®¤æµ‹è¯•å¯†é’¥
```
API Key: sk-8235b8630527ebe8ce372f4264fbee7c
ç”¨æˆ·ID: user_test001
æè¿°: ç”¨äºæµ‹è¯•çš„é»˜è®¤APIå¯†é’¥
çŠ¶æ€: active
```

#### 2. ç®¡ç†å‘˜å¯†é’¥
```
API Key: sk-3b41696d49609f82140c1317e01f0cac
ç”¨æˆ·ID: user_admin
æè¿°: ç®¡ç†å‘˜ä¸“ç”¨APIå¯†é’¥
çŠ¶æ€: active
```

#### 3. å¼€å‘æµ‹è¯•å¯†é’¥
```
API Key: sk-5c7500123ebc15c2e740ca1978cdda41
ç”¨æˆ·ID: user_developer
æè¿°: ç”¨äºå¼€å‘ç¯å¢ƒçš„APIå¯†é’¥
çŠ¶æ€: active
```

#### 4. æ¼”ç¤ºå¯†é’¥
```
API Key: sk-7192bff91c4a65ac0af3e901b6daa791
ç”¨æˆ·ID: user_demo
æè¿°: ç”¨äºæ¼”ç¤ºçš„APIå¯†é’¥
çŠ¶æ€: active
```

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åœ¨å‰ç«¯ä½¿ç”¨

å¤åˆ¶ä»»æ„ä¸€ä¸ªAPI Keyåˆ°å‰ç«¯çš„API Keyè¾“å…¥æ¡†ä¸­å³å¯ã€‚

### ä½¿ç”¨curlæµ‹è¯•

```bash
curl -X POST http://localhost:8000/api/v1/detection/detect \
  -H "Authorization: Bearer sk-8235b8630527ebe8ce372f4264fbee7c" \
  -H "Content-Type: application/json" \
  -d '{"text": "ä½ çš„æµ‹è¯•æ–‡æœ¬"}'
```

### ä½¿ç”¨Pythonæµ‹è¯•

```python
import requests

headers = {
    'Authorization': 'Bearer sk-8235b8630527ebe8ce372f4264fbee7c',
    'Content-Type': 'application/json'
}
data = {'text': 'æµ‹è¯•æ–‡æœ¬'}

response = requests.post(
    'http://localhost:8000/api/v1/detection/detect',
    headers=headers,
    json=data
)

print(response.json())
```

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

### æ•°æ®åº“è¡¨ç»“æ„

**api_keys è¡¨**:
- `id`: å¯†é’¥å”¯ä¸€æ ‡è¯†
- `user_id`: æ‰€å±ç”¨æˆ·ID
- `name`: å¯†é’¥åç§°
- `description`: å¯†é’¥æè¿°
- `api_key**: å®é™…çš„å¯†é’¥å­—ç¬¦ä¸²
- `status`: çŠ¶æ€ (active/revoked)
- `call_count`: è°ƒç”¨æ¬¡æ•°ç»Ÿè®¡
- `create_time`: åˆ›å»ºæ—¶é—´
- `last_used`: æœ€åä½¿ç”¨æ—¶é—´

### è‡ªåŠ¨ç»Ÿè®¡

- âœ… æ¯æ¬¡APIè°ƒç”¨éƒ½ä¼šæ›´æ–° `call_count`
- âœ… è®°å½• `last_used` æ—¶é—´
- âœ… ç»Ÿè®¡ç”¨æˆ·ä½¿ç”¨é‡

## ğŸ”„ ä¸‹æ¬¡å¦‚æœå¯†é’¥åˆä¸¢å¤±äº†

åªéœ€è¿è¡Œåˆå§‹åŒ–è„šæœ¬ï¼š

```bash
cd /Users/menghao/Documents/å¹»è°±/å¤§æ¨¡å‹å®‰å…¨æ£€æµ‹å·¥å…·/SafetyProtection/backend
python3 init_test_api_keys_v2.py
```

è„šæœ¬ä¼šï¼š
1. æ¸…ç†æ—§çš„æµ‹è¯•æ•°æ®
2. åˆ›å»ºæ–°çš„ç”¨æˆ·å’ŒAPIå¯†é’¥
3. æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨çš„APIå¯†é’¥

## ğŸ‰ æ€»ç»“

âœ… **é—®é¢˜å·²å®Œå…¨è§£å†³**

- APIå¯†é’¥ç°åœ¨å­˜å‚¨åœ¨PostgreSQLæ•°æ®åº“ä¸­
- æœåŠ¡å™¨é‡å¯ä¸ä¼šä¸¢å¤±æ•°æ®
- æä¾›äº†4ä¸ªé¢„é…ç½®çš„APIå¯†é’¥
- æ‰€æœ‰å¯†é’¥éƒ½å·²éªŒè¯å¯ä»¥æ­£å¸¸ä½¿ç”¨

**å¤åˆ¶ä»»æ„ä¸€ä¸ªAPI Keyå³å¯å¼€å§‹ä½¿ç”¨ï¼** ğŸ”‘âœ¨
