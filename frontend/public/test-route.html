<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è·¯ç”±æµ‹è¯•</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .card { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; }
        .success { color: #52c41a; }
        .error { color: #ff4d4f; }
        button { background: #1890ff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ§ª è·¯ç”±æµ‹è¯•å·¥å…·</h1>

    <div class="card">
        <h2>æ­¥éª¤1: ç™»å½•è·å–Token</h2>
        <button onclick="login()">ç™»å½• (testuser/test123)</button>
        <div id="login-status"></div>
    </div>

    <div class="card">
        <h2>æ­¥éª¤2: ä¿å­˜Tokenå¹¶æµ‹è¯•è·¯ç”±</h2>
        <button onclick="saveToken()">ä¿å­˜Token</button>
        <button onclick="testRoute('/usercenter/projects')">æµ‹è¯• /usercenter/projects</button>
        <button onclick="testRoute('/usercenter/bills')">æµ‹è¯• /usercenter/bills</button>
        <div id="route-status"></div>
    </div>

    <div class="card">
        <h2>æ­¥éª¤3: è·³è½¬åˆ°åº”ç”¨</h2>
        <button onclick="goToApp()">å‰å¾€åº”ç”¨ä¸»é¡µ</button>
        <button onclick="goToProjects()">ç›´æ¥å‰å¾€Projectsé¡µé¢</button>
        <button onclick="goToDebug()">å‰å¾€è¯Šæ–­å·¥å…·</button>
    </div>

    <div class="card">
        <h2>å½“å‰çŠ¶æ€</h2>
        <div id="current-status">
            <p>Token: <span id="token-status">æœªè®¾ç½®</span></p>
            <p>UserInfo: <span id="user-status">æœªè®¾ç½®</span></p>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        function updateStatus() {
            const token = localStorage.getItem('access_token');
            const user = localStorage.getItem('user_info');

            document.getElementById('token-status').textContent = token ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®';
            document.getElementById('token-status').className = token ? 'success' : 'error';
            document.getElementById('user-status').textContent = user ? 'å·²è®¾ç½®' : 'æœªè®¾ç½®';
            document.getElementById('user-status').className = user ? 'success' : 'error';
        }

        async function login() {
            const status = document.getElementById('login-status');
            status.innerHTML = '<p class="info">ç™»å½•ä¸­...</p>';

            try {
                const response = await fetch(`${API_BASE}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        username: 'testuser',
                        password: 'test123'
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    status.innerHTML = `<p class="success">âœ… ç™»å½•æˆåŠŸ!</p><p>ç”¨æˆ·: ${data.user.username}</p>`;
                    window.tempToken = data.access_token;
                    window.tempUser = data.user;
                } else {
                    status.innerHTML = `<p class="error">âŒ ç™»å½•å¤±è´¥: ${data.detail}</p>`;
                }
            } catch (error) {
                status.innerHTML = `<p class="error">âŒ é”™è¯¯: ${error.message}</p>`;
            }
        }

        function saveToken() {
            if (window.tempToken && window.tempUser) {
                localStorage.setItem('access_token', window.tempToken);
                localStorage.setItem('user_info', JSON.stringify(window.tempUser));
                updateStatus();
                alert('Tokenå·²ä¿å­˜!');
            } else {
                alert('è¯·å…ˆç™»å½•!');
            }
        }

        async function testRoute(path) {
            const status = document.getElementById('route-status');
            const token = localStorage.getItem('access_token');

            if (!token) {
                status.innerHTML = '<p class="error">âŒ è¯·å…ˆç™»å½•å¹¶ä¿å­˜Token!</p>';
                return;
            }

            status.innerHTML = `<p class="info">æµ‹è¯•è·¯ç”±: ${path}</p>`;

            // æµ‹è¯•APIæ˜¯å¦å¯è®¿é—®
            try {
                const response = await fetch(`${API_BASE}/api/v1/user/projects`, {
                    headers: { 'Authorization': token }
                });

                if (response.ok) {
                    const data = await response.json();
                    status.innerHTML += `<p class="success">âœ… APIæ­£å¸¸ (è·å–åˆ° ${data.length} ä¸ªAPI Keys)</p>`;
                } else {
                    status.innerHTML += `<p class="error">âŒ APIè¿”å› ${response.status}</p>`;
                }
            } catch (error) {
                status.innerHTML += `<p class="error">âŒ APIé”™è¯¯: ${error.message}</p>`;
            }

            status.innerHTML += `<p class="info">ç°åœ¨å¯ä»¥å°è¯•è·³è½¬åˆ°: <a href="${path}" target="_blank">${path}</a></p>`;
        }

        function goToApp() {
            window.location.href = '/';
        }

        function goToProjects() {
            window.location.href = '/usercenter/projects';
        }

        function goToDebug() {
            window.location.href = '/debug.html';
        }

        window.onload = updateStatus;
    </script>
</body>
</html>
